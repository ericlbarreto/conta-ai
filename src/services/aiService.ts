import { DocumentFile, ChatMessage } from '@/types';

// Service para integraÃ§Ã£o com API de IA
export class AIService {
  private documents: DocumentFile[] = [];
  private apiUrl: string;

  constructor(apiUrl: string = 'http://localhost:3001/api/ai') {
    this.apiUrl = apiUrl;
  }

  // Adiciona documentos para envio
  setDocuments(documents: DocumentFile[]) {
    this.documents = documents;
  }

  // Adiciona um documento
  addDocument(document: DocumentFile) {
    this.documents.push(document);
  }

  // Remove um documento
  removeDocument(documentId: string) {
    this.documents = this.documents.filter(doc => doc.id !== documentId);
  }

  // Limpa todos os documentos
  clearDocuments() {
    this.documents = [];
  }

  // Retorna os documentos atuais
  getDocuments(): DocumentFile[] {
    return this.documents;
  }

  // Prepara o payload para envio Ã  API
  preparePayload(query: string): FormData {
    const formData = new FormData();
    
    // Adiciona a mensagem do usuÃ¡rio
    formData.append('message', query);
    
    // Adiciona os arquivos
    this.documents.forEach((document, index) => {
      // Nota: Este mÃ©todo nÃ£o Ã© mais usado, pois agora usamos File[] diretamente
      // Mantido para compatibilidade
    });

    return formData;
  }

  // Retorna mensagem quando nÃ£o hÃ¡ documentos
  getNoDocumentsResponse(): string {
    return `ğŸ“‹ **OlÃ¡! Sou seu assistente de anÃ¡lise contÃ¡bil** ğŸ˜Š

Para comeÃ§armos, preciso que vocÃª envie seus documentos contÃ¡beis (PDF, Excel ou CSV). 

ApÃ³s o upload, poderei ajudÃ¡-lo com:
â€¢ ğŸ“Š AnÃ¡lise de receitas e despesas
â€¢ ğŸ’° CÃ¡lculo de lucros e margens
â€¢ ğŸ“ˆ SugestÃµes de grÃ¡ficos e visualizaÃ§Ãµes
â€¢ ğŸ“‹ Resumos executivos
â€¢ ğŸ” IdentificaÃ§Ã£o de tendÃªncias

**Estou aqui para tornar sua anÃ¡lise contÃ¡bil mais rÃ¡pida e precisa!** âœ¨`;
  }
}